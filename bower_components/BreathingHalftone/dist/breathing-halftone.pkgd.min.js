!function(t){"use strict";function i(t,e,s){for(var n in e){var a=e[n];t[n]=s&&"object"==typeof a&&!c(a)?i(t[n]||{},a,!0):a}return t}function e(t,i){var e=i.parentNode,s=i.nextElementSibling;s?e.insertBefore(t,s):e.appendChild(t)}function s(t,e){this.options=i({},this.constructor.defaults,!0),i(this.options,e,!0),this.img=t,l.canvas&&this.create()}function n(){var t=document.createElement("canvas"),i=t.getContext("2d");return{canvas:t,ctx:i}}function a(t,i,e){var s=t.prototype[i],n=i+"Timeout";t.prototype[i]=function(){var t=this[n];t&&clearTimeout(t);var i=arguments;this[n]=setTimeout(function(){s.apply(this,i),delete this[n]}.bind(this),e||100)}}var o=2*Math.PI,r=Math.sqrt(2),h=Object.prototype.toString,c=Array.isArray||function(t){return"[object Array]"===h.call(t)},l={};!function(){var t=document.createElement("canvas"),i=t.getContext&&t.getContext("2d");if(l.canvas=!!i,l.canvas){t.width=1,t.height=1,i.globalCompositeOperation="darker",i.fillStyle="#F00",i.fillRect(0,0,1,1),i.fillStyle="#999",i.fillRect(0,0,1,1);var e=i.getImageData(0,0,1,1).data;l.darker=153===e[0]&&0===e[1]}}();for(var v,d=0,u="webkit moz ms o".split(" "),p=t.requestAnimationFrame,g=t.cancelAnimationFrame,m=0;m<u.length&&(!p||!g);m++)v=u[m],p=p||t[v+"RequestAnimationFrame"],g=g||t[v+"CancelAnimationFrame"]||t[v+"CancelRequestAnimationFrame"];p&&g||(p=function(t){var i=(new Date).getTime(),e=Math.max(0,16-(i-d)),s=setTimeout(function(){t(i+e)},e);return d=i+e,s},g=function(t){clearTimeout(t)});var f=t.BreathingHalftone||{},y=f.Vector,C=f.Particle;s.defaults={dotSize:.025,dotSizeThreshold:.05,initVelocity:.02,oscPeriod:3,oscAmplitude:.2,isAdditive:!1,isRadial:!1,channels:["red","green","blue"],isChannelLens:!0,friction:.06,hoverDiameter:.3,hoverForce:-.02,activeDiameter:.6,activeForce:.01},s.prototype.create=function(){this.isActive=!0;var t=n();this.canvas=t.canvas,this.ctx=t.ctx,this.canvas.className=this.img.className,e(this.canvas,this.img),this.img.style.visibility="hidden",this.channels=this.options.isAdditive||l.darker?this.options.channels:["lum"],this.proxyCanvases={};for(var i=0,s=this.channels.length;s>i;i++){var a=this.channels[i];this.proxyCanvases[a]=n()}this.loadImage(),this.canvasPosition=new y,this.getCanvasPosition(),this.cursors={},this.addCursor("mouse",{pageX:-1e5,pageY:-1e5}),this.bindEvents()},s.prototype.getCanvasPosition=function(){var i=this.canvas.getBoundingClientRect(),e=i.left+t.pageXOffset,s=i.top+t.pageYOffset;this.canvasPosition.set(e,s),this.canvasScale=this.width?this.width/this.canvas.offsetWidth:1},s.prototype.loadImage=function(){var t=this.img.getAttribute("data-src")||this.img.src,i=new Image;i.onload=function(){this.onImgLoad()}.bind(this),i.src=t,this.img.src!==t&&(this.img.src=t)},s.prototype.onImgLoad=function(){this.getImgData(),this.resizeCanvas(),this.getCanvasPosition(),this.img.style.display="none",this.getCanvasPosition(),this.initParticles(),this.animate()},s.prototype.getImgData=function(){var t=n(),i=t.canvas,e=t.ctx;this.imgWidth=i.width=this.img.naturalWidth,this.imgHeight=i.height=this.img.naturalHeight,e.drawImage(this.img,0,0),this.imgData=e.getImageData(0,0,this.imgWidth,this.imgHeight).data},s.prototype.resizeCanvas=function(){var t=this.width=this.img.offsetWidth,i=this.height=this.img.offsetHeight;this.diagonal=Math.sqrt(t*t+i*i),this.imgScale=this.width/this.imgWidth,this.gridSize=this.options.dotSize*this.diagonal;for(var e in this.proxyCanvases){var s=this.proxyCanvases[e];s.canvas.width=t,s.canvas.height=i}this.canvas.width=t,this.canvas.height=i},s.prototype.initParticles=function(){var t=this.options.isRadial?"getRadialGridParticles":"getCartesianGridParticles";this.particles=[],this.channelParticles={};for(var i={red:1,green:2.5,blue:5,lum:4},e=0,s=this.channels.length;s>e;e++){var n=this.channels[e],a=i[n],o=this[t](n,a);this.channelParticles[n]=o,this.particles=this.particles.concat(o)}},s.prototype.animate=function(){this.isActive&&(this.update(),this.render(),p(this.animate.bind(this)))},s.prototype.update=function(){for(var t=0,i=this.particles.length;i>t;t++){var e=this.particles[t];for(var s in this.cursors){var n=this.cursors[s],a=n.isDown?"active":"hover",o=this.options[a+"Force"],r=this.options[a+"Diameter"],h=r/2*this.diagonal,c=y.subtract(e.position,n.position),l=Math.max(0,h-c.magnitude)/h;l=Math.cos(l*Math.PI)*-.5+.5,c.scale(l*o),e.applyForce(c)}e.update()}},s.prototype.render=function(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle=this.options.isAdditive?"black":"white",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation=this.options.isAdditive?"lighter":"darker";for(var t=0,i=this.channels.length;i>t;t++){var e=this.channels[t];this.renderGrid(e)}};var w={additive:{red:"#FF0000",green:"#00FF00",blue:"#0000FF",lum:"#FFF"},subtractive:{red:"#00FFFF",green:"#FF00FF",blue:"#FFFF00",lum:"#000"}};s.prototype.renderGrid=function(t){var i=this.proxyCanvases[t];i.ctx.fillStyle=this.options.isAdditive?"black":"white",i.ctx.fillRect(0,0,this.width,this.height);var e=this.options.isAdditive?"additive":"subtractive";i.ctx.fillStyle=w[e][t];for(var s=this.channelParticles[t],n=0,a=s.length;a>n;n++){var o=s[n];o.render(i.ctx)}this.ctx.drawImage(i.canvas,0,0)},s.prototype.getCartesianGridParticles=function(t,i){for(var e=[],s=this.width,n=this.height,a=Math.max(s,n)*r,o=this.gridSize,h=Math.ceil(a/o),c=Math.ceil(a/o),l=0;c>l;l++)for(var v=0;h>v;v++){var d=(v+.5)*o,u=(l+.5)*o;d-=(a-s)/2,u-=(a-n)/2,d-=s/2,u-=n/2;var p=d*Math.cos(i)-u*Math.sin(i),g=d*Math.sin(i)+u*Math.cos(i);p+=s/2,g+=n/2;var m=this.initParticle(t,p,g);m&&e.push(m)}return e},s.prototype.getRadialGridParticles=function(t,i){for(var e=[],s=this.width,n=this.height,a=Math.max(s,n)*r,h=this.gridSize,c=s/2,l=n/2,v=h,d=c+Math.cos(i)*v,u=l+Math.sin(i)*v,p=Math.ceil((a+v)/h),g=0;p>g;g++)for(var m=6*g||1,f=0;m>f;f++){var y=o*f/m+i,C=d+Math.cos(y)*g*h,w=u+Math.sin(y)*g*h,P=this.initParticle(t,C,w);P&&e.push(P)}return e},s.prototype.initParticle=function(t,i,e){var s=this.getPixelChannelValue(i,e,t);if(!(s<this.options.dotSizeThreshold))return new C({channel:t,parent:this,origin:new y(i,e),naturalSize:this.gridSize*r/2,friction:this.options.friction})};var P={red:0,green:1,blue:2};s.prototype.getPixelChannelValue=function(t,i,e){t=Math.round(t/this.imgScale),i=Math.round(i/this.imgScale);var s=this.imgWidth,n=this.imgHeight;if(0>t||t>s||0>i||i>n)return 0;var a,o=4*(t+i*s);if("lum"===e)a=this.getPixelLum(o);else{var r=o+P[e];a=this.imgData[r]/255}return a=a||0,this.options.isAdditive||(a=1-a),a},s.prototype.getPixelLum=function(t){var i=this.imgData[t+0]/255,e=this.imgData[t+1]/255,s=this.imgData[t+2]/255,n=Math.max(i,e,s),a=Math.min(i,e,s);return(n+a)/2},s.prototype.bindEvents=function(){this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("touchstart",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1),t.addEventListener("resize",this,!1)},s.prototype.unbindEvents=function(){this.canvas.removeEventListener("mousedown",this,!1),this.canvas.removeEventListener("touchstart",this,!1),t.removeEventListener("mousemove",this,!1),t.removeEventListener("touchmove",this,!1),t.removeEventListener("touchend",this,!1),t.removeEventListener("resize",this,!1)},s.prototype.handleEvent=function(t){var i="on"+t.type;this[i]&&this[i](t)},s.prototype.onmousedown=function(i){i.preventDefault(),this.cursors.mouse.isDown=!0,t.addEventListener("mouseup",this,!1)},s.prototype.ontouchstart=function(t){t.preventDefault();for(var i=0,e=t.changedTouches.length;e>i;i++){var s=t.changedTouches[i],n=this.addCursor(s.identifier,s);n.isDown=!0}},s.prototype.addCursor=function(t,i){var e=this.setCursorPosition(i),s=this.cursors[t]={position:e,isDown:!1};return s},s.prototype.setCursorPosition=function(t,i){return i=i||new y,i.set(t.pageX,t.pageY),i.subtract(this.canvasPosition),i.scale(this.canvasScale),i},s.prototype.onmousemove=function(t){this.setCursorPosition(t,this.cursors.mouse.position)},s.prototype.ontouchmove=function(t){for(var i=0,e=t.changedTouches.length;e>i;i++){var s=t.changedTouches[i],n=this.cursors[s.identifier];n&&this.setCursorPosition(s,n.position)}},s.prototype.onmouseup=function(){this.cursors.mouse.isDown=!1,t.removeEventListener("mouseup",this,!1)},s.prototype.ontouchend=function(t){for(var i=0,e=t.changedTouches.length;e>i;i++){var s=t.changedTouches[i],n=this.cursors[s.identifier];n&&delete this.cursors[s.identifier]}},s.prototype.onresize=function(){this.getCanvasPosition()},a(s,"onresize",200),s.prototype.destroy=function(){this.isActive=!1,this.unbindEvents(),this.img.style.visibility="",this.img.style.display="",this.canvas.parentNode.removeChild(this.canvas)},s.Vector=y,s.Particle=C,t.BreathingHalftone=s}(window);